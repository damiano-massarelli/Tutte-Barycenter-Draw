<!DOCTYPE html>
<html lang="en">
<head>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/controlStyle.css">
    <link rel="stylesheet" type="text/css" href="css/graphStyle.css">

    <title>Graph toolkit</title>

    <script src="js/shaders/Shader.js"></script>
    <script src="js/kernels/Texture.js"></script>
    <script src="js/kernels/Kernel.js"></script>
    <script src="js/kernels/SpringEmbeddersKernel.js"></script>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="js/graph/GraphFileLoader.js"></script>
    <script src="js/algorithms/RaphsonNewtonAlgorithm.js"></script>
    <script src="js/algorithms/SpringEmbeddersAlgorithm.js"></script>
    <script src="js/algorithms/SpringEmbeddersGPUAlgorithm.js"></script>
    <script src="js/rendering/D3Renderer.js"></script>
    <script src="js/graph/Edge.js"></script>
    <script src="js/graph/Node.js"></script>
    <script src="js/graph/Graph.js"></script>
    <script src="js/graph/GraphLoader.js"></script>
    <script src="js/graph/GraphGLMFromServerLoader.js"></script>


</head>
<body>
    <svg id="svgCanvas" onclick="ctrl.closeNav()"></svg>
    <canvas id="canvas"></canvas>

    <span class="optionsbtn" onclick="ctrl.openNav()">&#9776; options</span>

    <div id="sidemenu" class="sidenav">
        <div class="sidenavContent">
            <a href="javascript:void(0)" class="closebtn" onclick="ctrl.closeNav()">&times;</a>

            <section>
                <h3>Choose a graph</h3>
                <h4>Load graph</h4>
                <input type="file" value="Choose a graph" onchange="ctrl.onFileSelect(event)">

                <h4>Predefined graphs</h4>
                <select onchange="ctrl.onPredefinedGraphSelectChange(this.value)">
                    <option value="" selected disabled>Choose a predefined graph</option>
                    <option value="./defaultGraphs/adam.json">adam</option>
                    <option value="./defaultGraphs/adam_directed.json">adam directed</option>

                    <option value="./defaultGraphs/rect.json">rect</option>
                </select>
        
                <h4>From Server</h4>
                <span>Server location:</span>
                <input type="text" value="localhost:1234/graph" placeholder="name:port" id="serverLocation"><br />
                <span>Nodes: </span><input class="controllerInput" type="number" placeholder="#nodes" value="10" id="numOfNodes">
                <span>Edges: </span><input class="controllerInput" type="number" placeholder="#edges" value="20" id="numOfEdges">
                <br><br>
                <input type="button" value="get from server" onclick="ctrl.onGetFromServer()">
            </section>

            <section>
                <h3>Algorithm</h3>
                <select onchange="ctrl.onAlgorithmChanged(this.value)">
                    <option value="Tutte" selected>Tutte Barycenter</option>
                    <option value="SpringEmbedders">Spring Embedders</option>
                    <option value="SpringEmbeddersGPU">Spring Embedders GPU</option>
                </select>

                <h4>Algorithm Settings</h4>

                <span>Speed:</span><br/>
                <input type="range" min="1" max="1000" value="1000" oninput="ctrl.onAlgorithmSpeedChanged(this.value)"
                    onchange="ctrl.onAlgorithmSpeedChanged(this.value)" id="algorithmSpeed">
                <span id="renderSpeed">100%</span>

                <div id="springEmbeddersSettings" style="margin-top: 15px;">
                    <span>Spring Rest Length: </span><input class="controllerInput" type="number" value="15" id="springRestLength"><br />
                    <span>Spring Dampening: </span><input class="controllerInput" type="number" value="0.125" step="0.01" id="springDampening"><br />
                    <span>Charge: </span><input class="controllerInput" type="number" value="75" id="charge"><br />
                    <input type="button" value="Apply" onclick="ctrl.onConfirmSpringEmbeddersSettings()">
                </div>
            </section>

            <section>
                <h3>Rendering</h3>
                <h4>Labels</h4>
                <label><input type="checkbox" onchange="ctrl.onShowNodeLabelsChange(this)">Show node labels</label><br />
                <label><input type="checkbox" onchange="ctrl.onShowEdgeLabelsChange(this)">Show edge labels</label>
            </section>

            <section>
                <h3>Stats</h3>
                <span>Algorithm time: </span><span id="algoTime"></span><span> ms</span><br />
                <span>Render time:</span><span id="renderTime"></span><span> ms</span>
            </section>

        </div>
    </div>

    <div id="errorDialog" class="errorDialog">
        <h1>Ops!</h1>
        <p id="errorMsg">Hi :) (if you are seeing this message something went wrong but we were too lazy to
            set an error message for it. If I were you I would open the console)</p>
        <a href="javascript:void(0)" class="closebtn" onclick="ctrl.closeErrorDialog()">&times;</a>
    </div>

    <script src="js/controllers/Controller.js"></script>
    <script>
        ctrl.openNav();

        // todo plz move me into a function
        gl = document.getElementById("canvas").getContext("webgl2");
        if (!gl) {
            ctrl.showError("Your browser does not support WebGL2. GPU based algorithms and rendering will not be available");
        }
        else {
            gl.pixelStorei(gl.PACK_ALIGNMENT, 1);
            gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);

            const colorBufferFloatExtension = gl.getExtension("EXT_color_buffer_float");
            if (!colorBufferFloatExtension) {
                ctrl.showError(`Your browser does not support floating point buffers.
                GPU based algorithm will not be available`);
            }
        }
    </script>

</body>
</html>