<!DOCTYPE html>
<html>
    <head>
        <script src="Texture.js"></script>
        <script src="Shader.js"></script>
        <script src="Kernel.js"></script>
        
    </head>

    <canvas id="a" width="300" height="300"></canvas>

    <script>

        const offscreen = document.getElementById("a");
        const gl = offscreen.getContext('webgl2');

        const ext = gl.getExtension("EXT_color_buffer_float");
        if (!ext) {
            alert("need EXT_color_buffer_float");
        }
        gl.pixelStorei(gl.PACK_ALIGNMENT, 1);
        gl.pixelStorei(gl.UNPACK_ALIGNMENT, 1);

        const data = new Uint8Array([1, 13, 2, 3, 3, 5, 6, 7, 0, 0, 11, 11, 12, 12, 13, 13]);

        const t = Texture.createTextureUint8_2(4, 2, data, true);
        console.log(t.getData());

        const t2 = Texture.createTextureUint8_2(4, 2, data, false);

        const frag = `#version 300 es
        precision mediump float;
        
        out uvec2 outData;
        
        void main() {
            outData = uvec2(1, 1);
        }`;

        const kernel = new Kernel(frag);
        kernel.setInputTexture("aaa", t2);
        kernel.setOutputTexture(t);

        kernel.execute();

        console.log(t.getData());

        /*const t = gl.createTexture();
        
        gl.bindTexture(gl.TEXTURE_2D, t);
        
        
        gl.texImage2D(gl.TEXTURE_2D, 0, gl.RG16I, 1, 1, 0, gl.RG_INTEGER, gl.SHORT, data);
        
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
        gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);


        fb = gl.createFramebuffer();

        // make this the current frame buffer
        gl.bindFramebuffer(gl.FRAMEBUFFER, fb);

        // attach the texture to the framebuffer.
        gl.framebufferTexture2D(
            gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0,
            gl.TEXTURE_2D, t, 0);

        // check if you can read from this type of texture.
        canRead = (gl.checkFramebufferStatus(gl.FRAMEBUFFER) == gl.FRAMEBUFFER_COMPLETE);
        console.log(canRead);

        out = new Int16Array(2);
        gl.readBuffer(gl.COLOR_ATTACHMENT0);
        gl.readPixels(0, 0, 1, 1, gl.RG_INTEGER, gl.SHORT, out);

        console.log(out);*/
    </script>

</html>